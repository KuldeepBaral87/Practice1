<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Axios</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"
      integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"
      integrity="sha512-onMTRKJBKz8M1TnqqDuGBlowlH0ohFzMXYRNebz+yOcc5TQr/zAKsthzhuv0hiyUKEiQEQXEynnXCvNTOk50dg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <main>
        <div class="form">
          <div class="input-wrapper">
            <input
              type="text"
              id="username"
              class=""
              placeholder="Enter Instagram UserID"
            />
            <input type="button" value="Fetch" class="" id="clickMe" />
          </div>
          <div class="text-wrapp">
            <h2 id="message" style="display: none">Loading...</h2>
          </div>
        </div>

        <div class="data" style="display: none">
          <div
            class="resultFetch"
            id="resultFetch"
            style="border-top: 1px solid blue"
          >
            <div style="font-size: 50px">
              <p>Dspome</p>
              <p>Text</p>
            </div>
          </div>

          <canvas id="myChart" style="width: 100%; max-width: 700px"></canvas>
        </div>
      </main>
    </div>

    <script>
      $(document).ready(function () {
        $("#clickMe").click(function (e) {
          $("#message").show();
          e.preventDefault();
          let username = document.querySelector("#username").value;
          // alert(username);

          console.log(username);
          const options = {
            method: "GET",
            url: "https://instagram-scraper-api2.p.rapidapi.com/v1/info",
            params: {
              username_or_id_or_url: username,
            },
            headers: {
              "x-rapidapi-key":
                "0a202d48ddmshf1aedcb1611d224p1cf000jsnbbad597e44e5",
              "x-rapidapi-host": "instagram-scraper-api2.p.rapidapi.com",
            },
          };

          axios
            .request(options)
            .then(function (response) {
              $("#message").hide();
              if (response.data) {
                $(".form").hide();
                $(".data").show();
                console.log(response.data);
                result = response.data.data;
                // Access specific data points
                const username_id = result.username;
                // const oldUsername =
                //   result.biography_with_entities?.entities[0]?.user?.username ||
                //   "";

                const fullName = result.full_name;
                const biography = result.biography;
                const profilePicUrl = result.profile_pic_url;
                const followerCount = result.follower_count;
                const followingCount = result.following_count;
                const mediaCount = result.media_count;
                // document.querySelector("#user_img").src = profilePicUrl;
                // Log specific data points
                console.log("Full Name: ", fullName);
                console.log("Biography: ", biography);
                console.log("Profile Picture URL: ", profilePicUrl);
                console.log("Follower Count: ", followerCount);

                let output = `<div class="inner-part">
            <p style="text-align:center; font-size:60px"><a href="https://www.instagram.com/${username}" class="no-effect">${username}</a></p>
            
            <p>${fullName}</p>
            <p>${biography}</p>
            <div class="follow-wrapper">
                
                <span class="follow">
                    <p>Followers</p>
                    <p>${followerCount}</p>
                </span>
                <span class="follow">
                    <p>Following</p>
                    <p>${followingCount}</p>
                </span>
            </div>
            <p>Number of posts:${mediaCount}</p>
        </div>`;

                document.querySelector("#resultFetch").innerHTML = output;

                // alert(output);//
                flwCount = "Followers:" + followerCount;
                flwingCount = "Following:" + followingCount;
                // Prepare data for Chart.js
                const labels = [flwCount, flwingCount];
                const chartData = [followerCount, followingCount];

                const ctx = document.getElementById("myChart").getContext("2d");
                const myChart = new Chart(ctx, {
                  type: "bar",
                  data: {
                    labels: labels,
                    datasets: [
                      {
                        label: fullName,
                        data: chartData,
                        backgroundColor: [
                          "rgba(255, 99, 132, 0.2)",
                          "rgba(54, 162, 235, 0.2)",
                          "rgba(75, 192, 192, 0.2)",
                        ],
                        borderColor: [
                          "rgba(255, 99, 132, 1)",
                          "rgba(54, 162, 235, 1)",
                          "rgba(75, 192, 192, 1)",
                        ],
                        borderWidth: 1,
                      },
                    ],
                  },
                  options: {
                    scales: {
                      y: {
                        beginAtZero: true,
                      },
                    },
                  },
                });
              } else {
                console.error("Data property not found in response.");
              }
            })
            .catch(function (error) {
              $(".data").show();
              $("#message").show();
              let msg = error.response.data.detail;
              let output = `<h2>${msg}</h2>`;
              document.querySelector("#message").innerHTML = output;

              console.error("error ye:", error.response.data);
            });
        });
      });
    </script>

    <script src="script.js"></script>
  </body>
</html>
